const t={idle:"idle",playing:"playing",win:"win",lose:"lose"},e=new class{constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=e,this.state=[...e.map(t=>[...t])],this.score=0,this.status=t.idle}moveLeft(){let t=[...this.state];if(!this.validateState(t))return;let e=t.map(t=>this.move(t));this.updateState(e),this.afterAction()}moveRight(){let t=[...this.state.map(t=>[...t].reverse())];if(!this.validateState(t))return;let e=t.map(t=>this.move(t).reverse());this.updateState(e),this.afterAction()}moveUp(){let t=this.rotateClockwise(this.state);if(!this.validateState(t))return;let e=[...t.map(t=>this.move([...t]))],s=this.rotateCounterClockwise(e);this.updateState(s),this.afterAction()}moveDown(){let t=[...this.rotateClockwise(this.state).map(t=>[...t].reverse())];if(!this.validateState(t))return;let e=t.map(t=>this.move([...t]).reverse()),s=this.rotateCounterClockwise(e);this.updateState(s),this.afterAction()}move(t){let e=[...t].filter(t=>0!==t),s=[],a=0;for(;a<=e.length;){let t=e[a],i=e[a+1];void 0!==t&&t===i?(s.push(2*t),this.score+=2*t,a+=2):(s.push(t),a+=1)}return t.map((t,e)=>s[e]||0)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.playing,this.afterAction(2)}restart(){this.resetState(),this.status=t.idle,this.score=0}resetState(){this.state=[...this.initialState.map(t=>[...t])]}updateState(t){this.state=t}createTile(){let t=this.getEmpty();if(0===t.length)return;let e=Math.floor(Math.random()*t.length),[s,a]=t[e];this.state[s][a]=Math.random()>.9?4:2}getEmpty(){let t=this.getState(),e=[];for(let s=0;s<t.length;s++)for(let a=0;a<t[s].length;a++)0===t[s][a]&&e.push([s,a]);return e}rotateClockwise(t){let e=t.length,s=t[0].length,a=[];for(let t=0;t<s;t++)a.push(Array(e).fill(""));for(let i=0;i<e;i++)for(let e=0;e<s;e++)a[s-1-e][i]=t[i][e];return a}rotateCounterClockwise(t){let e=t.length,s=t[0].length,a=[];for(let t=0;t<s;t++)a.push(Array(e).fill(""));for(let i=0;i<e;i++)for(let e=0;e<s;e++)a[i][s-1-e]=t[e][i];return a}afterAction(e=1){let s=this.getState();for(let t=0;t<e;t++)this.createTile();if(this.isWin(s)){this.status=t.win;return}this.isLose(s)&&(this.status=t.lose)}validateState(e){if(this.status!==t.playing)return;let s=e.some(t=>t.filter(t=>t).map((e,s)=>e===t[s+1]).includes(!0)),a=e.some(t=>{let e=t.findIndex(t=>0===t);return t.slice(e).findIndex(t=>0!==t)>0});return s||a}isWin(t){return t.flat().includes(2048)}isLose(t){let e=this.rotateClockwise(t),s=[...this.state.map(t=>[...t].reverse())],a=[...e.map(t=>[...t].reverse())];return[t,e,s,a].every(t=>!1===this.validateState(t))}},s=document.querySelector(".container"),a=s.querySelector(".button"),i=s.querySelector(".message-start"),r=s.querySelector(".message-restart"),l=s.querySelector(".message-lose"),n=s.querySelector(".message-win"),o=s.querySelector(".game-score"),h=[...document.querySelector(".game-field").querySelectorAll(".field-row")].map(t=>[...t.children]);function c(t,e){t.forEach((t,s)=>{t.forEach((t,a)=>{let i=e[s][a];0===t?(i.classList="field-cell",i.innerHTML=""):(i.classList=`field-cell field-cell--${t}`,i.innerHTML=t)})})}function d(){switch(e.getStatus()){case"playing":i.classList.add("hidden"),r.classList.remove("hidden");break;case"win":r.classList.add("hidden"),n.classList.remove("hidden");break;case"lose":i.classList.add("hidden"),r.classList.add("hidden"),l.classList.remove("hidden");break;default:i.classList.remove("hidden"),r.classList.add("hidden"),n.classList.add("hidden"),l.classList.add("hidden")}}a.addEventListener("click",()=>{if("Start"===a.textContent)e.start(),c(e.getState(),h),a.textContent="Restart",a.classList.add("restart"),a.classList.remove("start");else{var t;e.restart();let s=e.getState();t=e.getScore(),o.innerHTML=t,c(s,h),a.textContent="Start",a.classList.add("start"),a.classList.remove("restart")}d()}),document.addEventListener("keydown",t=>{if(t.preventDefault(),"playing"!==e.getStatus())return;switch(t.key){case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown();break;case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight()}let s=e.getState(),a=e.getScore();c(s,h,a),o.innerHTML=a,d()});
//# sourceMappingURL=index.5ef58f45.js.map
